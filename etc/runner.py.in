# -*- coding: utf-8 -*-

from cromdemo.wsgi import demo_application
from crom import monkey, implicit
from cromlech.configuration.utils import load_zcml
from cromlech.i18n import load_translations_directories
from fanstatic import Fanstatic
from cromlech.wsgistate.middleware import file_session_wrapper


# Bootstrapping the Crom registry
monkey.incompat()
implicit.initialize()

# read the ZCML
load_zcml("${zcml:output}")

# load translation
load_translations_directories()

# Create the application, including the middlewares.
sessionned = file_session_wrapper(
    demo_application, session_cache="${app:sessions}",
    timeout=${app:sessions_timeout})
application = Fanstatic(sessionned)
